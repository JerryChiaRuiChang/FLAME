<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get Detailed Information After Matching • FLAME</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Get Detailed Information After Matching">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FLAME</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CATE.html">Get Detailed Information After Matching</a>
    </li>
    <li>
      <a href="../articles/Matching_Quality.html">Matching Quality</a>
    </li>
    <li>
      <a href="../articles/Synthetic_Data.html">Apply the FLAME Algorithm to Synthetic Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/chiarui424/FLAME">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Get Detailed Information After Matching</h1>
                        <h4 class="author">Jerry Chia-Rui Chang</h4>
            
            <h4 class="date">2018-10-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/chiarui424/FLAME/blob/master/vignettes/CATE.Rmd"><code>vignettes/CATE.Rmd</code></a></small>
      <div class="hidden name"><code>CATE.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates how to get detailed information such as conditional average treatment effect (CATE), variance, and average treatment effect (ATE) from the <code>FLAME</code> package after matching.</p>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>First, we applied <code>Data_Generation</code> function to generate 1000 treated units and 1000 control units, where U = 5 with 10 important covariates and 5 unimportant covariates. Assume holdout training data is the same as input data. Second, we ran <code>FLAME_bit</code> function for matching, where <code>compute_var</code> is specified to be true.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/Data_Generation">Data_Generation</a></span>(<span class="dt">num_control =</span> <span class="dv">1000</span>, <span class="dt">num_treated =</span> <span class="dv">1000</span>,
                               <span class="dt">num_cov_dense =</span> <span class="dv">10</span>, <span class="dt">num_cov_unimportant =</span> <span class="dv">5</span>, <span class="dt">U =</span> <span class="dv">5</span>)
holdout &lt;-<span class="st"> </span>data <span class="co">#Assume holdout training data is the same as input data</span>
result_bit &lt;-<span class="st"> </span>FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/FLAME_bit">FLAME_bit</a></span>(<span class="dt">data =</span> data, <span class="dt">holdout =</span> holdout, <span class="dt">compute_var =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] "number of unmatched units =  2000"</span>
<span class="co">#&gt; [1] "number of unmatched units =  2000"</span>
<span class="co">#&gt; [1] "number of unmatched units =  2000"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1975"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1925"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1718"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1155"</span>
<span class="co">#&gt; [1] "number of unmatched units =  553"</span>
<span class="co">#&gt; [1] "number of unmatched units =  286"</span>
<span class="co">#&gt; [1] "number of unmatched units =  178"</span>
<span class="co">#&gt; [1] "number of unmatched units =  106"</span>
<span class="co">#&gt; [1] "number of unmatched units =  69"</span>
<span class="co">#&gt; [1] "number of unmatched units =  37"</span>
<span class="co">#&gt; [1] "number of unmatched units =  22"</span>
<span class="co">#&gt; [1] "number of unmatched units =  8"</span></code></pre></div>
</div>
<div id="conditional-average-treatment-effect-cate" class="section level2">
<h2 class="hasAnchor">
<a href="#conditional-average-treatment-effect-cate" class="anchor"></a>Conditional Average Treatment Effect (CATE)</h2>
<p>We can get each matched group’s conditional average treatment effect (CATE) and other related information from functions <code>CATE</code>, <code>MATCH</code>, and <code>CATE_AVG</code>. Let’s use an example when the FLAME algorithm performs matching with 8 covariates at a particular iteration. These 8 covariates are as below.</p>
<pre><code>#&gt; [1] "x1" "x2" "x3" "x4" "x5" "x6" "x7" "x9"</code></pre>
<p><strong>a.</strong><br>
If we want to see all matched groups at this iteration, apply <code>CATE</code> function to get the summary by providing inputs including (1) object returned by applying the FLAME matching algorithm, and (2) number of covariates used for matching with argument <code>num_covs</code>. Note that if there is no matched group, <code>CATE</code> function will return nothing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/CATE">CATE</a></span>(<span class="dt">FLAME_object =</span> result_bit, <span class="dt">num_covs  =</span> <span class="dv">8</span>))
<span class="co">#&gt;   x1 x2 x3 x4 x5 x6 x7 x9 effect size variance</span>
<span class="co">#&gt; 1  0  0  1  0  0  0  1  0 0.8007    8   1.4523</span>
<span class="co">#&gt; 2  1  0  0  0  0  0  0  0 1.7883   10  12.6208</span>
<span class="co">#&gt; 3  0  0  0  0  0  0  0  1 1.9112    5   8.4526</span>
<span class="co">#&gt; 4  0  0  0  0  0  0  1  0 2.3000    7  21.0925</span>
<span class="co">#&gt; 5  1  0  0  0  0  0  1  1 3.7877    6  12.4324</span>
<span class="co">#&gt; 6  0  1  0  0  1  0  0  0 4.0818    5   0.1924</span></code></pre></div>
<p>Let’s look at one of the matched groups. This matched group has the following covariate combination.</p>
<pre><code>#&gt;  x1  x2  x3  x4  x5  x6  x7  x9 
#&gt; "0" "0" "1" "0" "0" "0" "1" "0"</code></pre>

<p><strong>b.</strong><br>
If we want to see the conditional average treatment effect, matched size, and variance of this covariate combination, apply <code>CATE</code> function by providing inputs including (1) object returned by applying the FLAME matching algorithm, (2) number of covariates used for matching with argument <code>num_covs</code>, (3) covariate names with argument <code>cov_name</code>, and (4) corresponding covariate values with argument <code>cov_val</code> (Note that covariate values have to be <em>character</em> R data type).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#covariate names</span>
cov_name 
<span class="co">#&gt; [1] "x1" "x2" "x3" "x4" "x5" "x6" "x7" "x9"</span>

<span class="co">#covariate values in character R data type</span>
cov_val 
<span class="co">#&gt; [1] "0" "0" "1" "0" "0" "0" "1" "0"</span>

FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/CATE">CATE</a></span>(<span class="dt">FLAME_object =</span> result_bit, <span class="dt">num_covs  =</span> <span class="dv">8</span>, <span class="dt">cov_name =</span> cov_name, <span class="dt">cov_val =</span> cov_val)
<span class="co">#&gt;    x1 x2 x3 x4 x5 x6 x7 x9 effect size variance</span>
<span class="co">#&gt; 1   0  0  1  0  0  0  1  0 0.8007    8    1.452</span>
<span class="co">#&gt; 15  0  0  1  0  0  0  1  0 7.1359    5   21.015</span></code></pre></div>

<p><strong>c.</strong><br>
If we to know which observations/units produce this covariate combination, apply <code>MATCH</code> function with three inputs including (1) object returned by applying the FLAME matching algorithm, (2) covariate names with argument <code>cov_name</code>, and (3) corresponding covariate values with argument <code>cov_val</code> (Note that covariates values have to be <em>character</em> R data type).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/MATCH">MATCH</a></span>(<span class="dt">FLAME_object =</span> result_bit, <span class="dt">cov_name =</span> cov_name, <span class="dt">cov_val =</span> cov_val)
<span class="co">#&gt;   x1 x2 x3 x4 x5 x6 x7 x8 x9 x10 x11 x12 x13 x14 x15 outcome treated</span>
<span class="co">#&gt; 1  0  0  1  0  0  0  1  0  0   0   0   0   1   1   1 -0.2367       0</span>
<span class="co">#&gt; 2  0  0  1  0  0  0  1  0  0   0   0   0   1   0   1 -0.2367       0</span>
<span class="co">#&gt; 3  0  0  1  0  0  0  1  0  0   0   0   0   1   1   1 -0.2367       0</span>
<span class="co">#&gt; 4  0  0  1  0  0  0  1  0  0   1   0   1   0   1   0  0.3837       0</span>
<span class="co">#&gt; 5  0  0  1  0  0  0  1  0  0   0   0   1   0   0   0 -0.2367       0</span>
<span class="co">#&gt; 6  0  0  1  0  0  0  1  1  0   0   0   0   1   0   0 -0.6662       1</span>
<span class="co">#&gt; 7  0  0  1  0  0  0  1  1  0   1   0   0   1   0   0  1.3651       1</span>
<span class="co">#&gt; 8  0  0  1  0  0  0  1  1  0   1   1   0   1   0   0  1.3651       1</span></code></pre></div>

<p><strong>d.</strong> Assume we want to see all matched groups containing the covariate combination <strong>x1 = 1, x3 = 0, x5 = 1, x7 = 0, x9 = 1</strong>. Specifically, even when the FLAME algorithm performs matching with more than 5 covariates, we can still apply <code>CATE</code> function to output all possible matches as long as it contains the specified covariate combination. The input requirements are the same as (b), but <code>num_covs</code> argument does not need to be specified.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CATE_object &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CATE.html">CATE</a></span>(<span class="dt">FLAME_object =</span> result_bit, 
                    <span class="dt">cov_name =</span> <span class="kw">c</span>(<span class="st">"x1"</span>, <span class="st">"x3"</span>, <span class="st">"x5"</span>, <span class="st">"x7"</span>, <span class="st">"x9"</span>), 
                    <span class="dt">cov_val =</span> <span class="kw">c</span>(<span class="st">"1"</span>, <span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"0"</span>, <span class="st">"1"</span>))
CATE_object
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;    x1 x2 x3 x4 x5 x6 x7 x8 x9 x10 x15 effect size variance</span>
<span class="co">#&gt; 6   1  0  0  0  1  1  0  0  1   1   0  12.23    4        0</span>
<span class="co">#&gt; 10  1  1  0  0  1  1  0  1  1   0   1  23.59    4        0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt;    x1 x2 x3 x4 x5 x6 x7 x8 x9 x10 effect size variance</span>
<span class="co">#&gt; 42  1  1  0  1  1  0  0  1  1   1  40.03    4        0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt;    x1 x2 x3 x4 x5 x6 x7 x8 x9 effect size variance</span>
<span class="co">#&gt; 80  1  0  0  1  1  1  0  1  1  24.07    6  1.50365</span>
<span class="co">#&gt; 95  1  1  0  1  1  1  0  1  1  39.65    7  0.07697</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt;    x1 x2 x3 x4 x5 x6 x7 x9 effect size variance</span>
<span class="co">#&gt; 28  1  0  0  0  1  0  0  1  11.10    6   12.764</span>
<span class="co">#&gt; 43  1  1  0  0  1  0  0  1  18.67    6    9.571</span>
<span class="co">#&gt; 85  1  1  0  1  1  1  0  1  41.63    4    5.587</span></code></pre></div>

<p><strong>e.</strong><br>
We can compute estimated treatment effects of all matched groups in (d) with <code>AVG_EFFECT</code> function. Note that estimated treatment effect is the weighted average of CATEs, with weight being the number of units in each matched group. In addition, we can visualize the distribution of all CATEs in boxplot by applying <code>CATE_plot</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Estimated treatment effects </span>
<span class="kw"><a href="../reference/AVG_EFFECT.html">AVG_EFFECT</a></span>(CATE_object) 
<span class="co">#&gt; [1] 26.11</span>

<span class="kw"><a href="../reference/CATE_plot.html">CATE_plot</a></span>(CATE_object)</code></pre></div>
<p><img src="CATE_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div id="average-treatment-effect-ate-and-summary-visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#average-treatment-effect-ate-and-summary-visualization" class="anchor"></a>Average Treatment Effect (ATE) and Summary Visualization</h2>
<p>We can compute average treatment effect for each given sub-population by a weighted average of the estimated treatment effects in each matched group. The weight is the number of units in each matched group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/ATE">ATE</a></span>(result_bit)
<span class="co">#&gt; [1] 19.45</span></code></pre></div>

<p>Apply <code>summary_plot</code> function to visualize the process of matching as the algorithm drops covariate iteratively. The x-axis is the covariate dropped at each iteration. The y-axis on the left is the number of units matched, and the y-axis on the right is the estimated treatment effects. Note that since all covariates are used for matching in the beginning, no covariate is dropped and is represented by NA in the covariate dropped axis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/summary_plot">summary_plot</a></span>(result_bit)</code></pre></div>
<p><img src="CATE_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#setup">Setup</a></li>
      <li><a href="#conditional-average-treatment-effect-cate">Conditional Average Treatment Effect (CATE)</a></li>
      <li><a href="#average-treatment-effect-ate-and-summary-visualization">Average Treatment Effect (ATE) and Summary Visualization</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Chia-Rui (Jerry) Chang, Cynthia Rudin, Alexander Volfovsky, Sudeepa Roy.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
