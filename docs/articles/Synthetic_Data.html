<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modeling Synthetic Data â€¢ FLAME</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Modeling Synthetic Data">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FLAME</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Synthetic_Data.html">Modeling Synthetic Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Modeling Synthetic Data</h1>
                        <h4 class="author">Jerry Chia-Rui Chang</h4>
            
            <h4 class="date">2018-06-14</h4>
      
      
      <div class="hidden name"><code>Synthetic_Data.Rmd</code></div>

    </div>

    
    
<div id="load-required-package" class="section level2">
<h2 class="hasAnchor">
<a href="#load-required-package" class="anchor"></a>Load Required Package</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(FLAME)
<span class="kw">library</span>(RSQLite)
<span class="kw">library</span>(RPostgreSQL)
<span class="co">#&gt; Loading required package: DBI</span>
<span class="kw">library</span>(reticulate)</code></pre></div>
</div>
<div id="create-synthetic-data" class="section level2">
<h2 class="hasAnchor">
<a href="#create-synthetic-data" class="anchor"></a>Create Synthetic Data</h2>
<p><code>Data_Generation</code> function creates simulated data with specific characteristics and known treatment effects. The following function is used to generate synthetic data.</p>

<p><span class="math display">\[
\begin{aligned}
&amp; y = \sum_{i}\alpha_{i}x_{i} + T\sum_{i}\beta_{i}x_{i} + T \cdot U \sum_{i=1..5, \gamma = 1...5, \gamma &gt; i} x_{i}x_{\gamma}
\end{aligned}
\]</span> <span class="math inline">\(T \in \{0,1\}\)</span> indicates whether an unit is treated or in control. <span class="math inline">\(\alpha_{i} \sim N(10s, 1)\)</span> with <span class="math inline">\(s \sim Uniform\{-1,1\}\)</span>, <span class="math inline">\(\beta_{i} \sim N(1.5,0.15)\)</span>, and <span class="math inline">\(U\)</span> represents the coefficient of non-linear term.</p>

<p>Apply <code>Data_Generation</code> function to generate 100 treated units and 100 control units, where U = 5 with 10 important covariates and 5 unimportant covariates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/Data_Generation">Data_Generation</a></span>(<span class="dt">num_control =</span> <span class="dv">100</span>, <span class="dt">num_treated =</span> <span class="dv">100</span>,
                               <span class="dt">num_cov_dense =</span> <span class="dv">10</span>, <span class="dt">num_cov_unimportant =</span> <span class="dv">5</span>, <span class="dt">U =</span> <span class="dv">5</span>)

holdout &lt;-<span class="st"> </span>data <span class="co">#create holdout training data the same as synthetic data</span></code></pre></div>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(data)
<span class="co">#&gt;   x1 x2 x3 x4 x5 x6 x7 x8 x9 x10 x11 x12 x13 x14 x15     outcome treated</span>
<span class="co">#&gt; 1  0  0  1  1  1  0  0  0  1   0   1   0   1   0   1 -7.00056033       0</span>
<span class="co">#&gt; 2  1  1  1  1  0  1  1  0  0   0   1   0   0   1   1  1.08972583       0</span>
<span class="co">#&gt; 3  0  1  1  1  0  1  1  0  0   0   0   1   1   0   1 11.58570467       0</span>
<span class="co">#&gt; 4  0  1  1  0  1  1  1  0  1   0   0   0   0   1   1 16.93016051       0</span>
<span class="co">#&gt; 5  0  1  1  1  0  1  0  0  1   0   0   0   1   1   0 -0.01564768       0</span>
<span class="co">#&gt; 6  0  1  0  1  0  0  1  1  0   1   1   0   1   1   0  8.31219390       0</span></code></pre></div>
</div>
<div id="bit-vector-implementation" class="section level2">
<h2 class="hasAnchor">
<a href="#bit-vector-implementation" class="anchor"></a>Bit Vector Implementation</h2>
<p>One of the input requirement for FLAME_bit implementation is a list specifying the number of level each covariate has. For example, the data generation function generates 15 covariates, where each covariate has 2 level (binary variable). Therefore, the input requirement for <em>covs_max_list</em> list should be as below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">covs_max_list =<span class="st"> </span><span class="kw">rep</span>(<span class="dv">2</span>,<span class="dv">15</span>)
covs_max_list
<span class="co">#&gt;  [1] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span></code></pre></div>

<p>Run <code>FLAME_bit</code> function with the following command. The output contains two elements (1) list of matching covariates at each iteration (2) list of dataframe showing the size of matched group and its conditional average treatment effect (CATE)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result_bit &lt;-<span class="st"> </span>FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/FLAME_bit">FLAME_bit</a></span>(<span class="dt">data =</span> data, <span class="dt">holdout =</span> holdout, <span class="dt">num_covs =</span> <span class="dv">15</span>,
                               <span class="dt">num_treated =</span> <span class="dv">100</span>, <span class="dt">num_control =</span> <span class="dv">100</span>, 
                               <span class="dt">covs_max_list =</span> covs_max_list, <span class="dt">tradeoff =</span> <span class="fl">0.1</span>)</code></pre></div>
</div>
<div id="database-systems-implementation" class="section level2">
<h2 class="hasAnchor">
<a href="#database-systems-implementation" class="anchor"></a>Database Systems Implementation</h2>
<p>For database systems implementation, <code>FLAME</code> provides two versions - SQLite and PostgreSQL. PostgreSQL version requires installmenet of external database system and has faster implementation. SQLite version does not require external database system but its implementation is slower than PostgreSQL version.</p>
<div id="postgresql-version" class="section level3">
<h3 class="hasAnchor">
<a href="#postgresql-version" class="anchor"></a>PostgreSQL Version</h3>
<p>If your computer does not have PostgreSQL installed, please install from <a href="https://www.postgresql.org/download/">here</a>. For connecting and setup of PostgreSQL server, please refer to <a href="http://www.postgresqltutorial.com/connect-to-postgresql-database/">tutorial</a>.</p>

<p>Connect to PostgreSQL in R. Note that it is required to name the connection as <strong>db</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Connect to PostgreSQL</span>
drv &lt;-<span class="st"> </span><span class="kw">dbDriver</span>(<span class="st">'PostgreSQL'</span>)

<span class="co">#Name the connection as db</span>
db &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(drv, <span class="dt">user=</span><span class="st">"postgres"</span>, <span class="dt">dbname=</span><span class="st">"FLAME"</span>, <span class="dt">host=</span><span class="st">'localhost'</span>,
             <span class="dt">port=</span><span class="dv">5432</span>, <span class="dt">password =</span> <span class="st">'new_password'</span>)</code></pre></div>

<p>Run <code>FLAME_PostgreSQL</code> function with the following command. The output contains two elements (1) list of matching covariates at each iteration (2) list of dataframe showing the size of matched group and its conditional average treatment effect (CATE)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result_PostgreSQL &lt;-<span class="st"> </span>FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/FLAME_PostgreSQL">FLAME_PostgreSQL</a></span>(<span class="dt">db =</span> db, <span class="dt">data =</span> data, <span class="dt">holdout =</span> holdout,
                                             <span class="dt">num_covs =</span> <span class="dv">15</span>, <span class="dt">tradeoff =</span> <span class="fl">0.1</span>)</code></pre></div>

<p>Disconnect PostgreSQL</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dbDisconnect</span>(db)</code></pre></div>
</div>
<div id="sqlite-version" class="section level3">
<h3 class="hasAnchor">
<a href="#sqlite-version" class="anchor"></a>SQLite Version</h3>
<p>Connect to a temporary database in R. Note that it is required to name the connection as <strong>db</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Name the connection as conn</span>
db &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/RSQLite/topics/SQLite">SQLite</a></span>(),<span class="st">"tempdb"</span>) </code></pre></div>

<p>Run <code>FLAME_SQLite</code> function with the following command. The output contains two elements (1) list of matching covariates at each iteration (2) list of dataframe showing the size of matched group and its conditional average treatment effect (CATE)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result_SQLite &lt;-<span class="st"> </span>FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/FLAME_SQLite">FLAME_SQLite</a></span>(<span class="dt">db =</span> db, <span class="dt">data =</span> data, <span class="dt">holdout =</span> holdout,
                                             <span class="dt">num_covs =</span> <span class="dv">15</span>, <span class="dt">tradeoff =</span> <span class="fl">0.1</span>)</code></pre></div>

<p>Disconnect SQLite</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dbDisconnect</span>(db)</code></pre></div>
</div>
</div>
<div id="compare-result" class="section level2">
<h2 class="hasAnchor">
<a href="#compare-result" class="anchor"></a>Compare Result</h2>
<p>We compare the results of bit vector, PostgreSQL, and SQLite implementations.</p>

<ol style="list-style-type: decimal">
<li>Compare Average Treatment Effect</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/ATE.html">ATE</a></span>(result_bit) <span class="co">#bit vectors</span>
<span class="co">#&gt; [1] 19.67412</span>
<span class="kw"><a href="../reference/ATE.html">ATE</a></span>(result_PostgreSQL) <span class="co">#PostgreSQL</span>
<span class="co">#&gt; [1] 19.67412</span>
<span class="kw"><a href="../reference/ATE.html">ATE</a></span>(result_SQLite) <span class="co">#SQLite</span>
<span class="co">#&gt; [1] 19.67412</span></code></pre></div>

<ol start="2" style="list-style-type: decimal">
<li>Compare Conditional Average Treatment Effect with 15 covariates</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/CATE.html">CATE</a></span>(result_bit,<span class="dv">15</span>) <span class="co">#bit vectors</span>
<span class="co">#&gt; [1] 7.471399</span>
<span class="kw"><a href="../reference/CATE.html">CATE</a></span>(result_PostgreSQL,<span class="dv">15</span>) <span class="co">#PostgreSQL</span>
<span class="co">#&gt; [1] 7.471399</span>
<span class="kw"><a href="../reference/CATE.html">CATE</a></span>(result_SQLite,<span class="dv">15</span>) <span class="co">#SQLite</span>
<span class="co">#&gt; [1] 7.471399</span></code></pre></div>

<ol start="3" style="list-style-type: decimal">
<li>Compare Conditional Average Treatment Effect with 3 covariates</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/CATE.html">CATE</a></span>(result_bit,<span class="dv">3</span>) <span class="co">#bit vectors</span>
<span class="co">#&gt; [1] 3.559686</span>
<span class="kw"><a href="../reference/CATE.html">CATE</a></span>(result_PostgreSQL,<span class="dv">3</span>) <span class="co">#PostgreSQL</span>
<span class="co">#&gt; [1] 3.559686</span>
<span class="kw"><a href="../reference/CATE.html">CATE</a></span>(result_SQLite,<span class="dv">3</span>) <span class="co">#SQLite</span>
<span class="co">#&gt; [1] 3.559686</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#load-required-package">Load Required Package</a></li>
      <li><a href="#create-synthetic-data">Create Synthetic Data</a></li>
      <li><a href="#bit-vector-implementation">Bit Vector Implementation</a></li>
      <li><a href="#database-systems-implementation">Database Systems Implementation</a></li>
      <li><a href="#compare-result">Compare Result</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jerry Chia-Rui Chang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
