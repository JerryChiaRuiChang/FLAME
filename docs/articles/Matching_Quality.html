<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Matching Quality â€¢ FLAME</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Matching Quality">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FLAME</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CATE.html">Get Detailed Information After Matching</a>
    </li>
    <li>
      <a href="../articles/Matching_Quality.html">Matching Quality</a>
    </li>
    <li>
      <a href="../articles/Synthetic_Data.html">Apply the FLAME Algorithm to Synthetic Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/chiarui424/FLAME">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Matching Quality</h1>
                        <h4 class="author">Jerry Chia-Rui Chang</h4>
            
            <h4 class="date">2018-10-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/chiarui424/FLAME/blob/master/vignettes/Matching_Quality.Rmd"><code>vignettes/Matching_Quality.Rmd</code></a></small>
      <div class="hidden name"><code>Matching_Quality.Rmd</code></div>

    </div>

    
    
<div id="overview-of-matching-quality" class="section level2">
<h2 class="hasAnchor">
<a href="#overview-of-matching-quality" class="anchor"></a>Overview of Matching Quality</h2>
<p>The FLAME algorithm determines which unimportant covariate to drop based on Matching Quality, consisting of two components - Balancing Factor (<span class="math inline">\(BF\)</span>) and Predictive Error (<span class="math inline">\(PE\)</span>). Given a list of covariate subsets at a specific iteration, the algorithm chooses the covariate subset such that it maximizes Matching Quality, computed through <span class="math inline">\(-PE + tradeoff * BF\)</span>. Balancing factor assesses the proportion of units that can be matched. Predictive error evaluates the predictive quality of current sets of covariates, built upon machine learning algorithms such as ridge regression, LASSO, and decision tree. In short, matching quality is a bias-variance tradeoff between producing more matched groups and having better prediction.</p>
<p>The implementation of the FLAME algorithm allows users to choose both tradeoff parameter and statistical model that computes predictive error. First, users who prefer covariate subset that produces more matched units should choose higher tradeoff parameter, whereas users who prefer covariate subset that produces better predictive accuracy should choose lower tradeoff parameter. The default tradeoff parameter is set to 0.1. Second, users can choose appropriate statistical model to compute predictive error. The FLAME package currently provides four models; respectively they are Linear Regression, Ridge Regression, LASSO, and Decision Tree. The default model is set to ridge regression with L2 regularization parameter of 0.1. If users would like to use models not supported by the package, they can provide an input R function that computes predictive error.</p>
</div>
<div id="specify-models-to-compute-predictive-errors" class="section level2">
<h2 class="hasAnchor">
<a href="#specify-models-to-compute-predictive-errors" class="anchor"></a>Specify models to compute predictive errors</h2>
<p>Predictive error (<span class="math inline">\(PE\)</span>), in the FLAME algorithm, is defined as the sum of mean squared error for treated units and mean squared error for control units. Denote holdout training set <span class="math inline">\(D^{H} = [X^{H}, Y^{H}, T^{H}]\)</span>, where <span class="math inline">\(X^{H}\)</span> represents values of the covariates, <span class="math inline">\(Y^{H}\)</span> is the outcome, and <span class="math inline">\(T^{H}\)</span> indicates whether a unit is in treated group or in control group (1 = treated, 0 = control). Given a predictive model, denote <span class="math inline">\(\hat{Y}^{H}_{u}\)</span> as the predicted value of a unit <span class="math inline">\(u\)</span>. The computation of <span class="math inline">\(PE\)</span> is:</p>
<p><span class="math display">\[
PE = \frac{1}{\sum(1-T^{H}_{u})} \sum_{u:T^{H}_{u} = 0} (Y^{H}_{u} - \hat{Y}^{H}_{u})^2 + \frac{1}{\sum(T^{H}_{u})} \sum_{u:T^{H}_{u} = 1} (Y^{H}_{u} - \hat{Y}^{H}_{u})^2
\]</span></p>

<p>We demonstrate how to select various predictive models based on bit vectors implementation. Note that model specification for database systems implementation is the same as bit vectors implementation. We applied <code>Data_Generation</code> function to create a synthetic data. There are 1000 treated units and 1000 control units with 10 important covariates and 5 unimportant covariates. Assume holdout training set is the same as the input data.</p>
<pre><code>#&gt;   x1 x2 x3 x4 x5 x6 x7 x8 x9 x10 x11 x12 x13 x14 x15    outcome treated
#&gt; 1  1  0  0  0  0  1  1  1  0   0   1   1   0   0   0 -25.326354       0
#&gt; 2  1  1  1  1  0  0  0  1  0   1   0   1   1   1   0   5.172278       0
#&gt; 3  1  0  0  0  0  1  1  0  1   0   1   0   1   1   0 -11.501727       0
#&gt; 4  0  0  0  1  1  0  1  1  1   1   0   0   1   1   0   8.840892       0
#&gt; 5  1  1  1  0  1  1  0  0  0   0   1   0   0   0   1   3.435872       0
#&gt; 6  0  1  0  0  1  0  0  0  1   1   1   0   1   1   1  20.460055       0</code></pre>
<div id="package-provided-models" class="section level3">
<h3 class="hasAnchor">
<a href="#package-provided-models" class="anchor"></a>package provided models</h3>
<ol style="list-style-type: decimal">
<li>Linear Regression - R argument requires <code>model = "Linear"</code>
</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">linear &lt;-<span class="st"> </span>FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/FLAME_bit">FLAME_bit</a></span>(<span class="dt">data =</span> data, <span class="dt">holdout =</span> holdout, <span class="dt">model =</span> <span class="st">"Linear"</span>)
<span class="co">#&gt; [1] "number of unmatched units =  1938"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1873"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1784"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1568"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1321"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1012"</span>
<span class="co">#&gt; [1] "number of unmatched units =  688"</span>
<span class="co">#&gt; [1] "number of unmatched units =  453"</span>
<span class="co">#&gt; [1] "number of unmatched units =  280"</span>
<span class="co">#&gt; [1] "number of unmatched units =  231"</span>
<span class="co">#&gt; [1] "number of unmatched units =  150"</span>
<span class="co">#&gt; [1] "number of unmatched units =  108"</span>
<span class="co">#&gt; [1] "number of unmatched units =  68"</span>
<span class="co">#&gt; [1] "number of unmatched units =  68"</span>
<span class="co">#&gt; [1] "number of unmatched units =  26"</span></code></pre></div>

<ol start="2" style="list-style-type: decimal">
<li>Ridge Regression with L2 regularization parameter of 0.1 - R argument requires <code>model = "Ridge", ridge_reg = 0.1</code>
</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ridge &lt;-<span class="st"> </span>FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/FLAME_bit">FLAME_bit</a></span>(<span class="dt">data =</span> data, <span class="dt">holdout =</span> holdout, <span class="dt">model =</span> <span class="st">"Ridge"</span>, <span class="dt">ridge_reg =</span> <span class="fl">0.1</span>)
<span class="co">#&gt; [1] "number of unmatched units =  1938"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1873"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1784"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1568"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1321"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1012"</span>
<span class="co">#&gt; [1] "number of unmatched units =  688"</span>
<span class="co">#&gt; [1] "number of unmatched units =  453"</span>
<span class="co">#&gt; [1] "number of unmatched units =  280"</span>
<span class="co">#&gt; [1] "number of unmatched units =  231"</span>
<span class="co">#&gt; [1] "number of unmatched units =  150"</span>
<span class="co">#&gt; [1] "number of unmatched units =  108"</span>
<span class="co">#&gt; [1] "number of unmatched units =  68"</span>
<span class="co">#&gt; [1] "number of unmatched units =  68"</span>
<span class="co">#&gt; [1] "number of unmatched units =  26"</span></code></pre></div>

<ol start="3" style="list-style-type: decimal">
<li>Lasso with L1 regularization regularization parameter of 0.1 - R argument requires <code>model = "Lasso", lasso_reg = 0.1</code>
</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lasso &lt;-<span class="st"> </span>FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/FLAME_bit">FLAME_bit</a></span>(<span class="dt">data =</span> data, <span class="dt">holdout =</span> holdout, <span class="dt">model =</span> <span class="st">"Lasso"</span>, <span class="dt">lasso_reg =</span> <span class="fl">0.1</span>)
<span class="co">#&gt; [1] "number of unmatched units =  1938"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1873"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1756"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1565"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1318"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1009"</span>
<span class="co">#&gt; [1] "number of unmatched units =  685"</span>
<span class="co">#&gt; [1] "number of unmatched units =  449"</span>
<span class="co">#&gt; [1] "number of unmatched units =  276"</span>
<span class="co">#&gt; [1] "number of unmatched units =  229"</span>
<span class="co">#&gt; [1] "number of unmatched units =  149"</span>
<span class="co">#&gt; [1] "number of unmatched units =  108"</span>
<span class="co">#&gt; [1] "number of unmatched units =  68"</span>
<span class="co">#&gt; [1] "number of unmatched units =  68"</span>
<span class="co">#&gt; [1] "number of unmatched units =  26"</span></code></pre></div>

<ol start="4" style="list-style-type: decimal">
<li>Decision Tree with maximum depth of 8 - R argument requires <code>model = "DecisionTree", tree_depth = 8</code>
</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tree &lt;-<span class="st"> </span>FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/FLAME_bit">FLAME_bit</a></span>(<span class="dt">data =</span> data, <span class="dt">holdout =</span> holdout, <span class="dt">model =</span> <span class="st">"DecisionTree"</span>, <span class="dt">tree_depth =</span> <span class="dv">8</span>)
<span class="co">#&gt; [1] "number of unmatched units =  1938"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1887"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1780"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1612"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1338"</span>
<span class="co">#&gt; [1] "number of unmatched units =  992"</span>
<span class="co">#&gt; [1] "number of unmatched units =  687"</span>
<span class="co">#&gt; [1] "number of unmatched units =  441"</span>
<span class="co">#&gt; [1] "number of unmatched units =  313"</span>
<span class="co">#&gt; [1] "number of unmatched units =  194"</span>
<span class="co">#&gt; [1] "number of unmatched units =  150"</span>
<span class="co">#&gt; [1] "number of unmatched units =  112"</span>
<span class="co">#&gt; [1] "number of unmatched units =  95"</span>
<span class="co">#&gt; [1] "number of unmatched units =  72"</span>
<span class="co">#&gt; [1] "number of unmatched units =  10"</span></code></pre></div>
</div>
<div id="user-defined-model" class="section level3">
<h3 class="hasAnchor">
<a href="#user-defined-model" class="anchor"></a>user defined model</h3>
<p>If users would like to compute predictive error with models not supported by the package, users can provide their own R function. The package requires the input of the function to have four arguments; respectively, they are (1) outcome for treated units (<em>outcome_treated</em>), (2) outcome for control units (<em>outcome_control</em>), (3) covariate values for treated units in a matrix form (<em>covs_treated</em>), and (4) covariate values for control units in a matrix form (<em>covs_control</em>). The function should compute MSE for treated units with argument (1) and (3), and MSE for control units with argument (2) and (4).</p>
<p>We wrote a R function that computes predictive error based on support vector machine (SVM). The function is called <code>SVM_PE</code> based on SVM model in <code>e1071</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">SVM_PE &lt;-<span class="st"> </span><span class="cf">function</span>(outcome_treated, outcome_control, covs_treated, covs_control) {
  
  <span class="kw">library</span>(e1071) <span class="co">#load e1071 library</span>
  
  <span class="co"># MSE for treated</span>
  model_svm &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/e1071/topics/svm">svm</a></span>(outcome_treated <span class="op">~</span><span class="st"> </span>covs_treated) <span class="co"># fit the data to SVM model</span>
  pred_treated &lt;-<span class="st"> </span><span class="kw">predict</span>(model_svm, covs_treated) <span class="co">#get predicted values</span>
  MSE_treated &lt;-<span class="st"> </span><span class="kw">sum</span>((outcome_treated <span class="op">-</span><span class="st"> </span>pred_treated)<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span><span class="kw">length</span>(outcome_treated) <span class="co"># compute mean squared error</span>
  
  <span class="co"># MSE for control</span>
  model_svm &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/e1071/topics/svm">svm</a></span>(outcome_control <span class="op">~</span><span class="st"> </span>covs_control) <span class="co"># fit the data to SVM model</span>
  pred_control &lt;-<span class="st"> </span><span class="kw">predict</span>(model_svm, covs_control) <span class="co">#get predicted values</span>
  MSE_control &lt;-<span class="st"> </span><span class="kw">sum</span>((outcome_control <span class="op">-</span><span class="st"> </span>pred_control)<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span><span class="kw">length</span>(outcome_control) <span class="co"># compute mean squared error</span>
  
  <span class="kw">return</span>(MSE_treated <span class="op">+</span><span class="st"> </span>MSE_control)
}</code></pre></div>

<p>Apply the model as <code>PE_function = SVM_PE</code> to the package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">SVM &lt;-<span class="st"> </span>FLAME<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/FLAME/topics/FLAME_bit">FLAME_bit</a></span>(<span class="dt">data =</span> data, <span class="dt">holdout =</span> holdout, <span class="dt">PE_function =</span> SVM_PE)
<span class="co">#&gt; [1] "number of unmatched units =  1938"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1897"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1795"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1632"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1299"</span>
<span class="co">#&gt; [1] "number of unmatched units =  1004"</span>
<span class="co">#&gt; [1] "number of unmatched units =  686"</span>
<span class="co">#&gt; [1] "number of unmatched units =  423"</span>
<span class="co">#&gt; [1] "number of unmatched units =  307"</span>
<span class="co">#&gt; [1] "number of unmatched units =  218"</span>
<span class="co">#&gt; [1] "number of unmatched units =  128"</span>
<span class="co">#&gt; [1] "number of unmatched units =  116"</span>
<span class="co">#&gt; [1] "number of unmatched units =  38"</span>
<span class="co">#&gt; [1] "number of unmatched units =  16"</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview-of-matching-quality">Overview of Matching Quality</a></li>
      <li><a href="#specify-models-to-compute-predictive-errors">Specify models to compute predictive errors</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Chia-Rui (Jerry) Chang, Cynthia Rudin, Alexander Volfovsky, Sudeepa Roy.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
